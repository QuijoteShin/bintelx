# snippets/csp.map.conf
# CSP mappings por dominio - INCLUIR EN CONTEXTO http {} de nginx.conf
#
# Uso: include /path/to/snippets/csp.map.conf;
#      (debe ir ANTES de los server blocks)

# -- CSP connect-src por host --
map $host $csp_connect_src {
    default                     "'self'";

    # QA Labtronic
    ~^(.+\.)?qa\.labtronic\.cl$ "'self' wss://$host";

    # ERP Labtronic (produccion)
    ~^(.+\.)?erp\.labtronic\.cl$ "'self' wss://$host";

    # Desarrollo local
    ~^(.+\.)?dev\.local$        "'self' ws://$host wss://$host";
}

# -- CSP script-src por host --
map $host $csp_script_src {
    default                     "'self' 'unsafe-inline' 'unsafe-eval'";

    # Mismo para todos por ahora
    ~^(.+\.)?labtronic\.cl$     "'self' 'unsafe-inline' 'unsafe-eval'";
    ~^(.+\.)?dev\.local$        "'self' 'unsafe-inline' 'unsafe-eval'";
}

# -- CSP style-src por host --
map $host $csp_style_src {
    default                     "'self' 'unsafe-inline'";
}

# -- CSP img-src por host --
map $host $csp_img_src {
    default                     "'self' data:";
}

# -- CSP media-src por host --
map $host $csp_media_src {
    default                     "'self' data:";
}

# -- CSP default-src por host --
map $host $csp_default_src {
    default                     "'self'";
}
